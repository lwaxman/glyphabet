function setup(){textFillColour=color(0,0,0,150),rectMode(CENTER);for(var e=0;8>e;e++)layers[e]=new Layer;windowHeight>windowWidth?windowHeight=windowWidth:windowWidth>windowHeight&&(windowWidth=windowHeight),pg=createGraphics(windowWidth,windowHeight+20),pg.textFont(font),createCanvas(windowWidth,windowHeight),getText(),draw(),getText()}function draw(){background(255,255,255),noLoop(),layers[currentLayer].styleMode=style,layers[currentLayer].colour=textFillColour,layers[currentLayer].grid=gridSize,layers[currentLayer].onGrid=structure,layers[currentLayer].minShapeSize=minSize,layers[currentLayer].maxShapeSize=maxSize,layers[currentLayer].font=font,layers[currentLayer].stroke=strokeShow,layers[currentLayer].xOffset=xOffset,layers[currentLayer].yOffset=yOffset,layers[currentLayer].alpha=alphaVal;for(var e=0;layerCount>e;e++)layers[e].display()}function componentToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function rgbToHex(e,t,i){return componentToHex(e)+componentToHex(t)+componentToHex(i)}function getHexValue(e){return rgbToHex(e.rgba[0],e.rgba[1],e.rgba[2])}function switchLayers(e){currentLayer=parseInt(e,10),$(".layer").removeClass("active"),$("#layer"+currentLayer).addClass("active"),style=layers[currentLayer].styleMode,textFillColour=layers[currentLayer].colour,gridSize=layers[currentLayer].grid,structure=layers[currentLayer].onGrid,minSize=layers[currentLayer].minShapeSize,maxSize=layers[currentLayer].maxShapeSize,font=layers[currentLayer].font,strokeShow=layers[currentLayer].stroke,xOffset=layers[currentLayer].xOffset,yOffset=layers[currentLayer].yOffset;var t=getHexValue(layers[currentLayer].colour);return $("#colourTextBox").val(t),$("#colourTextBox").css("background","#"+t),currentLayer}function addNewLayer(){return $("#layers").append("<div class='layer' id='layer"+layerCount+"'><div class='layerName'>LAYER"+layerCount+"</div><div class='edit'></div></div>"),switchLayers(layerCount),layerCount++,draw(),layerCount}function getTextSize(){var e=myType.split(""),t=e.length;textsize=windowWidth/t*1.2,textFont(font),textSize(textsize);var i=textWidth(myType),r=i/width;return.7>r&&r>=.5&&(textsize=windowWidth/t*1.6),.5>r&&(textsize=windowWidth/t*2),textsize}function drawNormal(e,t,i){textSize(getTextSize()),textFont(i),textAlign(CENTER),text(myType,windowWidth/2+e,windowHeight/2+.4*textsize+t)}function drawCircles(e,t,i,r,a,s){for(var o=textWidth(myType),n=width/2-o/2-150,l=width/2+o/2+150,d=height/2-.5*textsize-.9*textsize-150,h=height/2+.5*textsize+150,c=width/t,f=n;l>f;f+=c)for(var w=d;h>w;w+=c){var y=f,g=w,u=pg.get(y,g),x=random(i,r),v=random(-10,10);0==u[0]&&(e?ellipse(y+a,g+s,x,x):ellipse(y+a+v,g+s+v,x,x))}}function drawSquares(e,t,i,r,a,s){for(var o=textWidth(myType),n=width/2-o/2-150,l=width/2+o/2+150,d=height/2-.5*textsize-.9*textsize-150,h=height/2+.5*textsize+150,c=width/t,f=n;l>f;f+=c)for(var w=d;h>w;w+=c){var y=f,g=w,u=pg.get(y,g),x=random(i,r),v=random(-10,10);0==u[0]&&(e?rect(y+a,g+s,x,x):rect(y+a+v,g+s+v,x,x))}}function drawExes(e,t,i,r,a,s,o){for(var n=textWidth(myType),l=width/2-n/2-150,d=width/2+n/2+150,h=height/2-.5*textsize-.9*textsize-150,c=height/2+.5*textsize+150,f=width/t,w=l;d>w;w+=f)for(var y=h;c>y;y+=f){var g=w,u=y,x=pg.get(g,u),v=random(i,r),m=random(-10,10),v=random(i,r),p=v/2;stroke(o),0==x[0]&&(e?(line(g+a-p,u+s-p,g+a+p,u+s+p),line(g+a-p,u+s+p,g+a+p,u+s-p)):(stroke(o),line(g+a+m-p,u+m+s-p,g+m+a+p,u+m+s+p),line(g+a+m-p,u+m+s+p,g+m+a+p,u+m+s-p)))}}function drawLines(e,t,i,r,a,s,o){for(var n=textWidth(myType),l=width/2-n/2-150,d=width/2+n/2+150,h=height/2-.5*textsize-.9*textsize-150,c=height/2+.5*textsize+150,f=width/t,w=l;d>w;w+=f)for(var y=h;c>y;y+=f){var g=w,u=y,x=pg.get(g,u),v=random(i,r),m=random(-10,10),v=random(i,r),p=v/2;stroke(o),strokeWeight(2),0==x[0]&&(e?line(g+a-p,u+s-p,g+a+p,u+s+p):line(g+a+m-p,u+m+s-p,g+m+a+p,u+m+s+p))}}function drawTriangles(e,t,i,r,a,s,o){for(var n=textWidth(myType),l=width/2-n/2-150,d=width/2+n/2+150,h=height/2-.5*textsize-.9*textsize-150,c=height/2+.5*textsize+150,f=width/t,w=0,y=l;d>y;y+=f)for(var g=h;c>g;g+=f){w++;var u=y,x=g,v=pg.get(u,x),m=random(i,r),p=random(-10,10),m=random(i,r),S=m/2;0==v[0]&&(e?triangle(u,x,u,x+m,u+m,x):triangle(u+p,x+p,u+p,x+p+m,u+p+m,x+p))}}function polygon(e,t,i,r){var a=TWO_PI/r;beginShape();for(var s=0;TWO_PI>s;s+=a){var o=e+cos(s)*i,n=t+sin(s)*i;vertex(o,n)}endShape(CLOSE)}function drawPolygons(e,t,i,r,a,s){for(var o=textWidth(myType),n=width/2-o/2-150,l=width/2+o/2+150,d=height/2-.5*textsize-.9*textsize-150,h=height/2+.5*textsize+150,c=width/t,f=n;l>f;f+=c)for(var w=d;h>w;w+=c){var y=f,g=w,u=pg.get(y,g),x=random(i,r),v=random(-10,10);0==u[0]&&(e?polygon(y+a,g+s,.6*x,6):polygon(y+a+v,g+s+v,.6*x,6))}}function Layer(){this.xOffset=0,this.yOffset=0,this.styleMode="normal",this.font=font,this.colour=color(0,0,0,100),this.grid=80,this.stroke=strokeShow,this.opacity=!1,this.minShapeSize=5,this.maxShapeSize=10,this.onGrid=!0,this.alpha=180,this.display=function(){this.stroke?stroke(100):noStroke(),this.opacity?fill(this.colour):noFill(),textSize(getTextSize()),fill(this.colour),"circles"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawCircles(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset)):"squares"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawSquares(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset)):"exes"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawExes(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset,this.colour)):"lines"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawLines(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset,this.colour)):"triangles"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawTriangles(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset)):"polygons"==this.styleMode?($("#gridControl").show(),$("#slider1").show(),$("#slider2").show(),drawPolygons(this.onGrid,this.grid,this.minShapeSize,this.maxShapeSize,this.xOffset,this.yOffset)):"normal"==this.styleMode?($("#gridControl").hide(),$("#slider1").hide(),$("#slider2").hide(),drawNormal(this.xOffset,this.yOffset,this.font)):drawNormal(this.xOffset,this.yOffset,this.font)}}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function getColour(){colourBoxColour=$("#colourTextBox").val();var e=color(hexToRgb(colourBoxColour).r,hexToRgb(colourBoxColour).g,hexToRgb(colourBoxColour).b,alphaVal);return textFillColour=e,draw(),textFillColour}function getText(){var e=$("#textBox").val();""==e&&(e=" "),myType=e,pg=createGraphics(windowWidth+300,windowHeight+20),pg.background(255),pg.noStroke(),pg.fill(0),pg.textFont(font),pg.textAlign(CENTER),pg.textSize(getTextSize()),pg.textLeading(getTextSize()),pg.text(myType,windowWidth/2+xOffset,windowHeight/2+.4*textsize+yOffset),draw()}var myCanvas,windowWidth=$(window).width()-310,windowHeight=$(window).height()-10,pg,myType="TEXT",font="Helvetica",insideText=!1,style="normal",minSize=10,maxSize=20,textsize=100,gridSize=80,textFillColour,xOffset=0,yOffset=0,structure=!0,layerCount=1,strokeShow=!1,alphaVal=180,currentLayer=0,layers=[];$("#lightBox").hide(),$("#normal").on("click",function(){style="normal",$(".styleMode").removeClass("active"),$("#normal").addClass("active"),draw()}),$("#circles").on("click",function(){style="circles",$(".styleMode").removeClass("active"),$("#circles").addClass("active"),draw()}),$("#squares").on("click",function(){style="squares",$(".styleMode").removeClass("active"),$("#squares").addClass("active"),draw()}),$("#exes").on("click",function(){style="exes",$(".styleMode").removeClass("active"),$("#exes").addClass("active"),draw()}),$("#polygons").on("click",function(){style="polygons",$(".styleMode").removeClass("active"),$("#polygons").addClass("active"),draw()}),$("#lines").on("click",function(){style="lines",$(".styleMode").removeClass("active"),$("#lines").addClass("active"),draw()}),$("#triangles").on("click",function(){style="triangles",$(".styleMode").removeClass("active"),$("#triangles").addClass("active"),draw()}),$("#gridOn").on("click",function(){structure=!0,$(".gridControl").removeClass("active"),$("#gridOn").addClass("active"),draw()}),$("#gridOff").on("click",function(){structure=!1,$(".gridControl").removeClass("active"),$("#gridOff").addClass("active"),draw()}),$("#sansSerif").on("click",function(){$(".fontStyle").removeClass("active"),$("#sansSerif").addClass("active"),font="Helvetica",draw()}),$("#serif").on("click",function(){$(".fontStyle").removeClass("active"),$("#serif").addClass("active"),font="Georgia",draw()}),$("#monospace").on("click",function(){$(".fontStyle").removeClass("active"),$("#monospace").addClass("active"),font="monospace",draw()}),$("#brushScript").on("click",function(){$(".fontStyle").removeClass("active"),$("#brushScript").addClass("active"),font="Brush Script MT",draw()}),$("#save").on("click",function(){var e=document.getElementsByTagName("canvas");console.log(e);var t=e[0].toDataURL();console.log(t),$("#imageContainer").attr("src",t),$("#lightBox").show()}),$("#lightBox").on("click",function(){$("#lightBox").hide()});var editable=!1;$("#layers").on("click",".edit",function(){editable=!editable,editable?($(this).addClass("editActive"),$(this).siblings().attr("contenteditable","true")):($(this).removeClass("editActive"),$(this).siblings().attr("contenteditable","false"))}),$(window).resize(function(){console.log("resizing: "+$(window).width()),windowWidth=$(window).width()-310,windowHeight=$(window).height()-10,windowHeight>windowWidth?windowHeight=windowWidth:windowWidth>windowHeight&&(windowWidth=windowHeight),createCanvas(windowWidth,windowHeight),getText(),draw()}),$("#shapeSize-range").slider({range:!0,min:1,max:40,values:[10,20],slide:function(e,t){$("#shapeSize").val(t.values[0]+" - "+t.values[1]),minSize=t.values[0],maxSize=t.values[1],draw()}}),$("#shapeSize").val($("#shapeSize-range").slider("values",0)+" - "+$("#shapeSize-range").slider("values",1)),$("#gridSize-range").slider({value:80,min:30,max:250,range:"min",slide:function(e,t){$("#gridSize").val(t.value),gridSize=t.value,draw()}}),$("#gridSize").val($("#gridSize-range").slider("values",0)),$("#xOffset-range").slider({value:0,min:-50,max:50,range:"min",slide:function(e,t){$("#xOffset").val(t.value),xOffset=t.value,draw()}}),$("#xOffset").val($("#xOffset-range").slider("values",0)),$("#yOffset-range").slider({value:0,min:-50,max:50,range:"min",slide:function(e,t){$("#yOffset").val(t.value),yOffset=t.value,draw()}}),$("#yOffset").val($("#yOffset-range").slider("values",0)),$("#opacity-range").slider({value:180,min:0,max:255,range:"min",slide:function(e,t){$("#opacity").val(t.value),alphaVal=t.value,getColour(),draw()}}),$("#opacity").val($("#opacity-range").slider("values",0)),$("#newLayer").on("click",function(){console.log("new layer"),addNewLayer()}),$("#layers").on("click",".layer",function(){var e=this.id,t=e.split("r"),i=parseInt(t[1],10);$(".layer").removeClass("active"),$("#layer"+i).addClass("active"),console.log("#layer"+i),switchLayers(i)});var colourBoxColour;$("#colourTextBox").on("change",getColour),$("#textBox").keyup(getText);